# S2G
[1か月ゲーム制作チャレンジ作品]  
Siv3Dのサンプルとして公開されている「2D RPG のマップと移動の基本」(ゲーム典型 007A)を参考にしたダンジョン脱出ゲーム。  

![s2g](https://github.com/Surimi-FUM/S2G/assets/116449282/006cc80c-11e4-47fe-9b87-7eb16b8045a1)  


S2Gファイル：開発用ファイル。ゲーム部分のみ。  
S2G_Productファイル：開発用ファイル。タイトルからクリアシーンまで。  
実行ファイル：[配布] S2G/S2G.exe  

### 操作方法  
対応インタフェース：キーボード  
移動：カーソルキー  
ゲーム終了：Escキー  
？：スペースキー    

## 開発環境
PC：Windows 10 Pro、Intel Core i7-6700K  
IDE：Visual Studio 2022  
言語：C++(20)  
フレームワーク：Siv3D 0.6.6  
### テスト環境
開発環境と同じ

## 開発期間・人数
令和5年(2023)/03/08 ~ /03/25、1人  

## アップデート  
2023/05/10  Ver1.1  
・ヒートマップ可視化機能を追加  
・固定ルート移動の敵キャラクターのテクスチャ変更  
2023/05/12  Ver1.2  
・敵が安全地帯に入ってしまう不具合を修正  
・プレイヤ追跡時の敵の移動速度アップ  
2023/05/17  Ver1.3  
・幅優先探索の実装ミスを修正  
・敵の追加  
・操作マニュアルを追加  
・開発ファイルの統一  

## 目的
ゲーム制作最初の一歩。  
C++のスキルを磨くため、できるだけ処理はC++で実装する。  
グラフィック処理はSiv3Dに頼る。  
複雑にせず、まず完成させる。  

## 仕様
### ヒートマップ
敵がプレイヤーを発見し、追跡するプログラムにヒートマップを採用した。  
ステージと同じサイズのヒートマップを用意し、その温度を参照して敵の移動先を決定する。  
幅優先探索によって熱の伝播を行い、熱源との距離に応じて温度が減衰していく。  
敵は周囲4マスの温度を捜査し、温度が最も高いマスに移動することで、自動的にプレイヤを追跡するようになります。  

このシステムの利点は探索処理が1回で済むことである。  
敵が経路探索でプレイヤを捜す場合、敵の数だけ探索処理を繰り返さなければならないが、このシステムでは、敵は周囲4マスを探索するだけで済むため、処理が軽量。  
マイナスの温度を設定することで、安全地帯を簡単に実装することができます。  

スペースキーを押すと可視化することができる。  

![s2g_h_s](https://github.com/Surimi-FUM/S2G/assets/116449282/0e7df6f8-6533-4f82-8905-0380d298548c)  

設定は下記の通りである。  
| オブジェクト | 温度 | マンハッタン距離 | 
----|----|----  
| 壁 | 0 | - |  
| 空間 | 1 | - |  
| プレイヤ | 5 | L<sub>p</sub> = 5 |  
| スタート地点 | -5 | L<sub>s</sub> = 3 |  
| ゴール地点 | -5 | L<sub>g</sub> = 3 |  

プレイヤを熱源とし、移動ごとにヒートマップを更新していく。  
ヒートマップの更新は、プレイヤの位置からユークリッド距離 L<sub>p</sub>までの縦横4マスを幅優先探索で更新していく。  
ヒートマップの1と0ではないマスの温度は、更新処理の前に縦横4マスの内、最も低い温度の影響を受ける。  

敵は縦横4マスを走査して最も温度が高い方向へ移動する。  
周囲の温度が均一の場合はランダムで移動する。  

スタート地点やゴール地点に敵が居座ってしまうとゲームが成り立たなくなってしまうため、そういう地点にはマイナスの温度を設定し、ユークリッド距離 L<sub>s</sub>、L<sub>g</sub>の範囲を敵が侵入してこない安全地帯とした。 

## 反省  
・C++を再習得することができた。10年前に触れたころはCの延長だったため、vector<>などの配列関数の存在を初めて知った。変数[]で宣言するよりわかりやすいと思った。  
・ヒートマップでNPCを動かすことで、1か月で形にすることができたと思う。  
・ヒートマップの挙動だけでは手ごたえのある動きができないと思った。視線Layなどの他のアルゴリズムを併用するといい感じになると考える。  
・ゴール前に鍵付き扉などのギミックを設ければより遊び感が増すと思う。  
Ver1.3  
・アルゴリズムの実装ミスをしていた。後輩にプレイして貰ったことで発覚した。人に見せることの大切さを知った。  

## 使用したライセンス
・Siv3D　[https://github.com/Siv3D/OpenSiv3D](https://github.com/Siv3D/OpenSiv3D/blob/main/LICENSE)  
・音楽素材MusMus https://musmus.main.jp  
・「2D RPG のマップと移動の基本」(ゲーム典型 007A)　https://github.com/Reputeless/games/blob/main/LICENSE  
・ぴぽや https://pipoya.net/  
